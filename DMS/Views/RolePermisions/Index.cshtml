@model List<DMS.Models.RolePermissions>
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var uniqueModules = Model.Select(m => m.ModelloName).Distinct().ToList();
    var uniqueRoles = Model.Select(m => m.Role.Name).Distinct().ToList();
}
<style>
    #myTable {
        background: rgba(255, 255, 255, 0.1); /* Transparent glass effect */
        backdrop-filter: blur(10px); /* Frosted glass effect */
        border-radius: 12px;
        overflow: hidden; /* Prevents content from overflowing */
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2); /* Soft shadow */
    }

        /*  #myTable thead th {
                background-color: #092860;
                color: #fff;
                text-transform: uppercase;
                letter-spacing: 1px;
                padding: 15px;
            } */

        #myTable tbody tr {
            background: rgba(255, 255, 255, 0.5); /* Semi-transparent rows */
            transition: transform 0.2s ease-in-out;
        }

            #myTable tbody tr:hover {
                transform: scale(1.02); /* Slight zoom on hover */
                background: rgba(0, 123, 255, 0.1); /* Soft blue tint */
            }

        #myTable .btn-primary {
            background: linear-gradient(135deg, #092860;
            , #0056b3);
            color: #fff;
            border: none;
        }

        #myTable .btn-danger {
            background: linear-gradient(135deg, #e53935, #b71c1c);
            color: #fff;
            border: none;
        }

        #myTable img {
            border-radius: 12px;
            border: 3px solid #4CAF50;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

    .dataTables_filter input[type="search"] {
        width: 200px; /* Adjust width as desired */
        height: 30px; /* Adjust height as desired */
        padding: 5px 10px;
        border: 2px solid #007bff;
        border-radius: 8px;
        font-size: 14px; /* Slightly smaller text */
        outline: none; /* Removes focus outline */
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1); /* Soft shadow for a modern look */
    }

        .dataTables_filter input[type="search"]:focus {
            border-color: #092860; /* Darker blue on focus */
            background-color: #f0f8ff; /* Light blue background when active */
        }

    .dataTables_length label,
    .dataTables_filter label {
        color: #092860; /* Custom color for text */
        font-weight: 600; /* Bold for better visibility */
        font-size: 14px; /* Adjust size as desired */
    }

    .dataTables_length select {
        background-color: #092860; /* Blue background */
        color: darkblue; /* White text */
        border: 2px solid #092860; /* Border to match */
        border-radius: 5px; /* Rounded corners */
        padding: 2px 5px;
    }

    .dataTables_filter input[type="search"] {
        border: 2px solid #092860;
        border-radius: 5px;
        padding: 5px 10px;
    }

    .dataTables_info {
        color: #092860; /* Custom blue color */
        font-weight: 600; /* Bold for better visibility */
        font-size: 14px; /* Adjust size if needed */
    }

    .card-datatable {
        height: 100%; /* Set this based on your layout needs, or use 100vh for full viewport height */
    }

    #myTable_wrapper {
        height: 100%; /* Ensures the DataTable takes up full height of the container */
    }

    .dataTables_scrollBody {
        height: auto !important; /* Prevents scrollbars unless necessary */
    }

    .text-center{
        text-align:center !important;
    }
</style>

<!-- Content wrapper -->
<div class="content-wrapper">
    <!-- Content -->
    <div class="container-xxl flex-grow-1 container-p-y">
        @Html.Raw(TempData["AlertMessage"])
        <!-- DataTable with Buttons -->
        <div class="card">
            @* <a asp-action="Create" class="btn btn-primary  mb-1" style="margin-bottom:20px; margin-top:10px; margin-left:25px; width:150px">Add New</a> *@
            <div class="card-body">
                <div class="card-datatable table-responsive text-nowrap">
                    <div class="table-responsive">

                        <a asp-action="AddEditPermisions" style="border-radius:10px" class="btn btn-primary mb-3">+ Add </a>

                        <table class=" table-hover border-top" id="myTable">
                            <thead>
                                <tr>
                                    <th>Role</th>
                                    <th>Module</th>
                                    <th>Other</th>
                                    <th>Add</th>
                                    <th>Edit</th>
                                    <th>Delete</th>
                                    @* <th style="color:white">ReadOnly</th> *@
                                    <th class="text-center">Actions</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model != null && Model.Any())
                                {
                                    @foreach (var item in Model)
                                    {
                                        <tr>
                                            <td>@item.Role?.Name</td>
                                            <td>@item.ModelloName</td>
                                            <td class="text-center">@Html.CheckBox("All", item.All, new { disabled = "disabled" })</td>
                                            <td class="text-center">@Html.CheckBox("Add", item.Add, new { disabled = "disabled" })</td>
                                            <td class="text-center">@Html.CheckBox("Edit", item.Edit, new { disabled = "disabled" })</td>
                                            <td class="text-center">@Html.CheckBox("Delete", item.Delete, new { disabled = "disabled" })</td>
                                            @* <td class="text-center">@Html.CheckBox("Readonly", item.Readonly, new { disabled = "disabled" })</td> *@
                                            <td class="text-center">
                                                <a asp-action="AddEditPermisions" asp-route-id="@item.Id" class="btn btn-sm btn-primary" title="Edit">
                                                    <i class="bx bx-pencil"></i>
                                                </a>
                                                <button class="btn btn-sm btn-danger delete-btn" onclick="Delete('@item.Id')" data-id="@item.Id" title="Delete">
                                                    <i class="bx bx-trash"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    }
                                }
                                else
                                {
                                    <tr>
                                        <td colspan="8" class="text-center text-muted">No records found.</td>
                                    </tr>
                                }
                            </tbody>
                        </table>

                    </div>

                </div>
            </div>
        </div>
        <!-- Modal to add new record -->
    </div>
    <!-- / Content -->
    <div class="content-backdrop fade"></div>
</div>
<!-- Content wrapper -->
@section Scripts
{
    <script>
        $(document).ready(function () {
            $('#btnRolePermission').addClass("open");
            $('#btnManageRolePermission').addClass("active");
            $('#myTable').DataTable(); // Initialize DataTables

        });
        //Delete Data when click on save botton
        function Delete(ID) {
            debugger;
            var obj = { id: ID };

            // Using SweetAlert2
            Swal.fire({
                title: 'Are you sure?',
                text: "You won't be able to revert this!",
                icon: 'warning',  // Use 'icon' instead of 'type'
                showCancelButton: true,
                confirmButtonText: 'Delete',
                padding: '2em'
            }).then(function (result) {
                debugger;
                if (result.isConfirmed) {  // Check if the action was confirmed
                    $.ajax({
                        type: "POST",
                        url: "RolePermisions/Delete",
                        data: { 'id': ID },

                        success: function (response) {
                            debugger;
                            if (response.success) {
                                // If success, refresh or redirect to another page
                                window.location.href = "";
                            } else {
                                Swal.fire("Cancelled", response.message, "error");  // Show error if not successful
                            }
                            // if (member == "deleted") {
                            //     window.location.href = "";  // Refresh or redirect as needed
                            // }
                            // else {
                            //     Swal.fire("Cancelled", member, "error");  // Handle error case
                            // }
                        }
                    });
                }
            });
        }
        // $(".delete-btn").click(function () {
        //     let id = $(this).data("id");
        //     if (confirm("Are you sure you want to delete this permission?")) {
        //         $.post("/RolePermissions/Delete", { id: id }, function (data) {
        //             if (data.success) {
        //                 alert(data.message);
        //                 location.reload();
        //             } else {
        //                 alert("Error deleting permission.");
        //             }
        //         });
        //     }
        // });
    </script>
}
